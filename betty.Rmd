---
title: "Projekt A MT5016"
author: "Betty Frankl"
date: "`r Sys.Date()`"
output: html_document
---

## Projekt A

```{r, include=FALSE}
library(car)
library(knitr)
library(tidyverse)

load("data_1.Rda")
load("data_2.Rda")
```

```{r, include=FALSE}

# Functions

basic_plots <- function(data, title) {
  par(mfrow = c(2,3))
  plot(data$arbetslöshetsindex_män, data$självmordsfrekvens)
  plot(data$arbetslöshetsindex_total, data$självmordsfrekvens)
  plot(data$alkoholindex, data$självmordsfrekvens)
  plot(data$urbaniseringsindex, data$självmordsfrekvens)
  plot(data$skilsmässoindex, data$självmordsfrekvens)
  plot(data$religiositetsindex, data$självmordsfrekvens)
  
  mtext(title, side = 3, line = - 1, outer = TRUE)
}

plot_predicted_residuals <- function(multi_model, title) {
  plot(multi_model$fitted.values, multi_model$residuals,
       xlab = "predikterade värden",
       ylab = "residualer",
       main = title)
  abline(0,0)
} 

plot_multi_residuals <- function(data, multi_model, title) {
  par(mfrow = c(2,3))
  plot(residuals(multi_model) ~ data$arbetslöshetsindex_män, 
       xlab = "arbetslöshetsindex män",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0) 
  plot(residuals(multi_model) ~ data$arbetslöshetsindex_total, 
       xlab = "arbetslöshetsindex total",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0) 
  plot(residuals(multi_model) ~ data$alkoholindex, 
       xlab = "alkoholindex",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0) 
  plot(residuals(multi_model) ~ data$urbaniseringsindex, 
       xlab = "urbaniseringsindex",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0) 
  plot(residuals(multi_model) ~ data$skilsmässoindex, 
       xlab = "skilsmässoindex",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0) 
  plot(residuals(multi_model) ~ data$religiositetsindex, 
       xlab = "religiositetsindex",
       ylab = "residuals",
       main = "Spread of residuals")
  abline(0,0)
  
  mtext(title, side = 3, line = - 1, outer = TRUE)
}

plot_qq <- function(multi_model, title) {
  qqnorm(residuals(multi_model), 
         xlab = "Theoretical Quantiles",
         main = title)
  qqline(residuals(multi_model))
}
```

```{r}
sm_arb_män1 <- lm(självmordsfrekvens ~ arbetslöshetsindex_män, data = data_1)
sm_arb_tot1 <- lm(självmordsfrekvens ~ arbetslöshetsindex_total, data = data_1)
sm_alk1 <- lm(självmordsfrekvens ~ alkoholindex, data = data_1)
sm_urb1 <- lm(självmordsfrekvens ~ urbaniseringsindex, data = data_1)
sm_ski1 <- lm(självmordsfrekvens ~ skilsmässoindex, data = data_1)
sm_rel1 <- lm(självmordsfrekvens ~ religiositetsindex, data = data_1)

sm_arb_män2 <- lm(självmordsfrekvens ~ arbetslöshetsindex_män, data = data_2)
sm_arb_tot2 <- lm(självmordsfrekvens ~ arbetslöshetsindex_total, data = data_2)
sm_alk2 <- lm(självmordsfrekvens ~ alkoholindex, data = data_2)
sm_urb2 <- lm(självmordsfrekvens ~ urbaniseringsindex, data = data_2)
sm_ski2 <- lm(självmordsfrekvens ~ skilsmässoindex, data = data_2)
sm_rel2 <- lm(självmordsfrekvens ~ religiositetsindex, data = data_2)
```

```{r, echo=FALSE}
summary(sm_arb_män2)
summary(sm_arb_tot2)
summary(sm_alk1)
summary(sm_ski1)
```

```{r}
kable(cbind(c("Förklarande variabel", 
              "arbetslöshetsindex_män",
              "arbetslöshetsindex_total",
              "alkoholindex",
              "skilsmässoindex"),
            c("P-värde",
              "0.014",
              "0.0022",
              "0.00013",
              "0.0024")))
```

# New model data 1

```{r}
best_model_1 <- lm(data = data_1 %>% select(!län), självmordsfrekvens ~ religiositetsindex + alkoholindex + arbetslöshetsindex_total)

summary(best_model_1)
vif(best_model_1)
```

# 2.3 residuals

```{r}
par(mfrow = c(2,3))
plot_predicted_residuals(best_model_1, "Residuals best model period 1")
plot_qq(best_model_1, "Normal-QQ plot residuals")

plot.new()

plot(residuals(best_model_1) ~ data_1$arbetslöshetsindex_total, 
     xlab = "arbetslöshetsindex total",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(best_model_1) ~ data_1$alkoholindex, 
     xlab = "alkoholindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(best_model_1) ~ data_1$religiositetsindex, 
     xlab = "religiositetsindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0)

mtext("Residuals best model period 1", side = 3, line = - 1, outer = TRUE)
```

# New model data 2

```{r}
best_model_2 <- lm(data = data_2 %>% select(!län), självmordsfrekvens ~ arbetslöshetsindex_total+ urbaniseringsindex + skilsmässoindex + religiositetsindex)

summary(best_model_2)
vif(best_model_2)
```

# 3.5 residuals

```{r}
par(mfrow = c(2,3))
plot_predicted_residuals(best_model_2, "Residuals best model period 2")
plot_qq(best_model_2, "Best Model Period 2: Normal-QQ plot residuals")

plot(residuals(best_model_2) ~ data_2$arbetslöshetsindex_total, 
     xlab = "arbetslöshetsindex total",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(best_model_2) ~ data_2$urbaniseringsindex, 
     xlab = "urbaniseringsindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(best_model_2) ~ data_2$skilsmässoindex, 
     xlab = "skilsmässoindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(best_model_2) ~ data_2$religiositetsindex, 
     xlab = "religiositetsindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0)

mtext("Residuals best model period 2", side = 3, line = - 1, outer = TRUE)
```

# Alternative model 2

```{r}
alt_model_2 <- lm(data = data_2 %>% select(!län), självmordsfrekvens ~ urbaniseringsindex + alkoholindex)

summary(alt_model_2)
vif(alt_model_2)
```

# residuals

```{r}
par(mfrow = c(2,3))
plot_predicted_residuals(alt_model_2, "Residuals alt model period 2")
plot_qq(alt_model_2, "Alt Model Period 2: Normal-QQ plot residuals")

plot.new()

plot(residuals(alt_model_2) ~ data_2$alkoholindex, 
     xlab = "alkoholindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 
plot(residuals(alt_model_2) ~ data_2$urbaniseringsindex, 
     xlab = "urbaniseringsindex",
     ylab = "residuals",
     main = "Spread of residuals")
abline(0,0) 

mtext("Residuals alt model period 2", side = 3, line = - 1, outer = TRUE)
```
